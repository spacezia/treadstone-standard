"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[213],{81796:function(e,t,n){n.d(t,{Z:function(){return H}});var r=n(335),a=n.n(r),i=n(48305),l=n.n(i),s=n(90228),u=n.n(s),o=n(26068),c=n.n(o),d=n(87999),p=n.n(d),m=n(82092),f=n.n(m),h=n(37956),v=n(47113),x=n(35363),j=n(64684),g=n(70725),Z=n(73264),y=n(11204),w=n(17621),b=n(45144),C=n(71827),k=n(58778),A=n(55988),I=n(89178),E=n(56901),T=n(50959),S=n(7733),P=n(52883),D=(n(67825),n(16483)),O=n.n(D),R=n(64155),Y=function(e){if(e.startsWith("http")){var t=new URL(e);return t.pathname.startsWith("/")?t.pathname.substring(1):t.pathname}return e},M=function(e,t){return t.reduce((function(t,n){var r=e[n.name];return n.widget===S.l9.DATE&&e[n.name]?r=O()(e[n.name],"YYYY-MM-DD"):n.widget===S.l9.DATETIME&&e[n.name]?r=O()(e[n.name],"YYYY-MM-DD HH:mm:ss"):n.widget===S.l9.UPLOAD&&(Array.isArray(e[n.name])?r=e[n.name].map((function(e){return{name:Y(e),url:e,uid:(0,R.Z)()}})):"string"==typeof e[n.name]&&(r=[{name:Y(e[n.name]),url:e[n.name],uid:(0,R.Z)()}])),c()(c()({},t),{},f()({},n.name,r))}),{})},N=n(54322),_=n(11527),U=function(e,t){return Object.keys(e).forEach((function(n){var r=t.find((function(e){return e.name===n}));if(r&&r.widget===S.l9.UPLOAD&&e[n])if(r.multiple)Object.assign(e,f()({},n,e[n].map((function(e){var t;return e.response?null===(t=e.response.data)||void 0===t?void 0:t.url:decodeURIComponent(e.url)}))));else if(Array.isArray(e[n])&&e[n].length){var a,i;Object.assign(e,f()({},n,(null===(a=e[n][0])||void 0===a||null===(a=a.response)||void 0===a||null===(a=a.data)||void 0===a?void 0:a.url)||(null===(i=e[n][0])||void 0===i?void 0:i.url)))}else Object.assign(e,f()({},n,null))})),e},L=function(){var e=p()(u()().mark((function e(t){var n,r,a,i,l,s,o,d,p,m,f;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.path,r=t.params,a=void 0===r?{}:r,i=t.label,l=void 0===i?"name":i,s=t.key,o=void 0===s?"id":s,d=t.method,p=void 0===d?"POST":d,e.next=3,(0,P.pj)(n,{method:p,data:a});case 3:if(null==(m=e.sent)||!m.success){e.next=6;break}return e.abrupt("return",null===(f=m.data)||void 0===f?void 0:f.map((function(e){return c()(c()({},e),{},{label:e[l],value:e[o]})})));case 6:return e.abrupt("return",[]);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),H=function(e){var t=e.title,n=e.path,r=e.action,i=e.columns,s=e.actionRef,o=e.saveCallback,d=e.closeCallback,m=e.prefixComponent,D=e.method,O=void 0===D?"POST":D,R=e.width,Y=void 0===R?800:R,H=e.labelColSpan,z=void 0===H?4:H,V=e.wrapperColSpan,F=void 0===V?18:V,G=e.forceRender,W=void 0!==G&&G,q=(0,T.useState)(!1),B=l()(q,2),K=B[0],J=B[1],Q=(0,T.useState)(!1),$=l()(Q,2),X=$[0],ee=$[1],te=(0,T.useState)(),ne=l()(te,2),re=ne[0],ae=ne[1],ie=(0,T.useState)(!1),le=l()(ie,2),se=le[0],ue=le[1],oe=(0,T.useState)({}),ce=l()(oe,2),de=ce[0],pe=ce[1],me=(0,T.useState)({}),fe=l()(me,2),he=fe[0],ve=fe[1],xe=(0,T.useState)({}),je=l()(xe,2),ge=je[0],Ze=je[1],ye=h.Z.useApp().message,we=v.Z.useForm(),be=l()(we,1)[0];return(0,T.useImperativeHandle)(s,(function(){return{callCreateView:(t=p()(u()().mark((function e(t){var n,r,l;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:ee(!1),pe((null==t?void 0:t.params)||{}),null!=t&&t.values&&(ve(null==t?void 0:t.values),be.setFieldsValue(null==t?void 0:t.values)),J(!0),n=a()(i.filter((function(e){return e.reference}))),e.prev=5,l=u()().mark((function e(){var t,n;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.value,e.next=3,L(t.reference);case 3:n=e.sent,Ze((function(e){return c()(c()({},e),{},f()({},t.name,n))}));case 5:case"end":return e.stop()}}),e)})),n.s();case 8:if((r=n.n()).done){e.next=12;break}return e.delegateYield(l(),"t0",10);case 10:e.next=8;break;case 12:e.next=17;break;case 14:e.prev=14,e.t1=e.catch(5),n.e(e.t1);case 17:return e.prev=17,n.f(),e.finish(17);case 20:case"end":return e.stop()}}),e,null,[[5,14,17,20]])}))),function(e){return t.apply(this,arguments)}),callUpdateView:(e=p()(u()().mark((function e(t){var n,r,l,s;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:ee(!0),pe(t.params||{}),J(!0),ae(t.record),n=M(t.record,i),be.setFieldsValue(n),r=a()(i.filter((function(e){return e.reference}))),e.prev=7,s=u()().mark((function e(){var t,n;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=l.value,e.next=3,L(t.reference);case 3:n=e.sent,Ze((function(e){return c()(c()({},e),{},f()({},t.name,n))}));case 5:case"end":return e.stop()}}),e)})),r.s();case 10:if((l=r.n()).done){e.next=14;break}return e.delegateYield(s(),"t0",12);case 12:e.next=10;break;case 14:e.next=19;break;case 16:e.prev=16,e.t1=e.catch(7),r.e(e.t1);case 19:return e.prev=19,r.f(),e.finish(19);case 22:case"end":return e.stop()}}),e,null,[[7,16,19,22]])}))),function(t){return e.apply(this,arguments)}),closeView:function(){J(!1)}};var e,t})),(0,_.jsx)(x.Z,{centered:!0,width:Y,title:t||(X?"编辑记录":"新增记录"),open:K,destroyOnClose:!0,forceRender:W,confirmLoading:se,styles:{body:{padding:24}},footer:(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(j.ZP,{onClick:function(){J(!1)},children:"取消"}),(0,_.jsx)(j.ZP,{type:"primary",loading:se,onClick:p()(u()().mark((function e(){var t,a,l,s;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,be.validateFields();case 3:if(t=e.sent,a=U(t,i),ue(!0),l=c()(c()(c()({},a),he),de),!X){e.next=13;break}return e.next=10,(0,P.$G)(n,c()({id:null==re?void 0:re.id},l),r);case 10:e.t0=e.sent,e.next=16;break;case 13:return e.next=15,(0,P.fC)(n,l,O);case 15:e.t0=e.sent;case 16:null!=(s=e.t0)&&s.success&&(ye.success("保存成功"),J(!1),null==o||o({values:t,record:re,params:de,data:null==s?void 0:s.data}));case 18:return e.prev=18,ue(!1),e.finish(18);case 21:case"end":return e.stop()}}),e,null,[[0,,18,21]])}))),children:"保存"})]}),onCancel:function(){J(!1)},afterClose:function(){be.resetFields(),Ze({}),ve({}),null==d||d()},children:(0,_.jsx)(v.Z,{labelCol:{span:z},wrapperCol:{span:F},form:be,children:(0,_.jsxs)(g.Z,{children:[m,i.filter((function(e){return!0!==e.hideInForm})).map((function(e){var t,n={placeholder:e.placeholder,disabled:e.disabled};return e.multiple&&Object.assign(n,{mode:"multiple"}),(0,_.jsxs)(Z.Z,{span:24,children:[!e.widget&&(0,_.jsx)(v.Z.Item,{name:e.name,label:e.title,rules:e.rules,children:(0,_.jsx)(y.Z,c()({},n))}),e.widget===S.l9.INFO&&(0,_.jsx)(v.Z.Item,{name:e.name,label:e.title,rules:e.rules,children:(0,_.jsx)(y.Z,c()(c()({},n),{},{readOnly:!0}))}),e.widget===S.l9.INPUT&&(0,_.jsx)(v.Z.Item,{name:e.name,label:e.title,rules:e.rules,children:(0,_.jsx)(y.Z,c()({},n))}),e.widget===S.l9.INPUT_NUMBER&&(0,_.jsx)(v.Z.Item,{name:e.name,label:e.title,rules:e.rules,children:(0,_.jsx)(w.Z,c()({},n))}),e.widget===S.l9.PASSWORD&&(0,_.jsx)(v.Z.Item,{name:e.name,label:e.title,rules:e.rules,children:(0,_.jsx)(y.Z.Password,c()({},n))}),e.widget===S.l9.TEXTAREA&&(0,_.jsx)(v.Z.Item,{name:e.name,label:e.title,rules:e.rules,children:(0,_.jsx)(y.Z.TextArea,c()(c()({},n),{},{rows:e.rows||4}))}),e.widget===S.l9.SELECT&&(0,_.jsx)(v.Z.Item,{name:e.name,label:e.title,rules:e.rules,children:(0,_.jsx)(b.default,c()(c()({},n),{},{options:e.options}))}),e.widget===S.l9.DATE&&(0,_.jsx)(v.Z.Item,{name:e.name,label:e.title,rules:e.rules,children:(0,_.jsx)(C.default,c()(c()({},n),{},{format:e.format||"YYYY-MM-DD HH:mm:ss"}))}),e.widget===S.l9.DATETIME&&(0,_.jsx)(v.Z.Item,{name:e.name,label:e.title,rules:e.rules,children:(0,_.jsx)(C.default,c()(c()({},n),{},{showTime:!0,format:e.format||"YYYY-MM-DD HH:mm:ss"}))}),e.widget===S.l9.DATE_RANGE&&(0,_.jsx)(v.Z.Item,{name:e.name,label:e.title,rules:e.rules,children:(0,_.jsx)(C.default.RangePicker,{showTime:!1,format:e.format||"YYYY-MM-DD HH:mm:ss"})}),e.widget===S.l9.DATETIME_RANGE&&(0,_.jsx)(v.Z.Item,{name:e.name,label:e.title,rules:e.rules,children:(0,_.jsx)(C.default.RangePicker,{showTime:!0,format:e.format||"YYYY-MM-DD HH:mm:ss"})}),e.widget===S.l9.UPLOAD&&(0,_.jsx)(v.Z.Item,{name:e.name,label:e.title,rules:e.rules,valuePropName:"fileList",getValueFromEvent:function(e){return Array.isArray(e)?e:null==e?void 0:e.fileList},children:(0,_.jsxs)(k.Z,{action:"/api/system/alioss/upload",listType:"picture-card",multiple:null!==(t=e.multiple)&&void 0!==t&&t,accept:e.accept||".doc,audio/*,trends/*,image/*,.flv,.mkv,.rmvb,.doc,.docx,.pdf",headers:{Authorization:"Bearer ".concat(localStorage.getItem(S.Qt.ACCESS_TOKEN))},children:[(0,_.jsx)(N.Z,{})," 上传"]})}),e.widget===S.l9.RADIO&&(0,_.jsx)(v.Z.Item,{name:e.name,label:e.title,rules:e.rules,valuePropName:"checked",children:(0,_.jsx)(A.ZP.Group,{options:e.options||[]})}),e.widget===S.l9.SWITCH&&(0,_.jsx)(v.Z.Item,{name:e.name,label:e.title,rules:e.rules,valuePropName:"checked",children:(0,_.jsx)(I.Z,c()({},n))}),e.widget===S.l9.AUTOCOMPLETE&&(0,_.jsx)(v.Z.Item,{name:e.name,label:e.title,rules:e.rules,children:(0,_.jsx)(b.default,c()(c()({},n),{},{showSearch:!0,defaultActiveFirstOption:!0,notFoundContent:null,options:ge[e.name],filterOption:function(e,t){var n,r,a;return null===(n=null!==(r=null==t||null===(a=t.label)||void 0===a?void 0:a.toString())&&void 0!==r?r:"")||void 0===n?void 0:n.toLowerCase().includes(e.toLowerCase())},onChange:function(t,n){var r;if(null!==(r=e.reference)&&void 0!==r&&r.properties&&!Array.isArray(n)){var a=Object.keys(e.reference.properties).reduce((function(t,r){var a;return r&&null!=n&&n[r]?c()(c()({},t),{},f()({},null===(a=e.reference)||void 0===a?void 0:a.properties[r],null==n?void 0:n[r])):t}),{});pe((function(e){return c()(c()({},e),a)}))}}}))}),e.widget===S.l9.TREE_SELECT&&(0,_.jsx)(v.Z.Item,{name:e.name,label:e.title,rules:e.rules,children:(0,_.jsx)(E.Z,c()(c()({},n),{},{treeData:ge[e.name]||[],treeCheckable:e.checkable||!1,treeCheckStrictly:!1,showCheckedStrategy:E.Z.SHOW_PARENT}))})]},e.name)}))]})})})}},28213:function(e,t,n){n.d(t,{Z:function(){return P}});var r=n(90228),a=n.n(r),i=n(87999),l=n.n(i),s=n(26068),u=n.n(s),o=n(31040),c=n(14471),d=n(31331),p=n(64684),m=n(72002),f=n(21621),h=n(50959),v=n(7733),x=n(2389),j=n(25853),g=n(80525),Z=n(49704),y=n(12312),w=n(28127),b=n(6479),C=n(26709),k=n(85957),A=n(20869),I=n(33600),E=n(81796),T=n(10218),S=n(11527),P=function(e){var t=e.activateKey,n=e.actionRef,r=e.children,i=(0,I.useModel)("@@initialState"),s=i.initialState,P=i.setInitialState,D=h.useRef();return h.useImperativeHandle(n,(function(){return{callAppCreateView:function(){var e;null===(e=D.current)||void 0===e||e.callCreateView()},callAppUpdateView:function(e){var t;null===(t=D.current)||void 0===t||t.callUpdateView({record:e})}}})),h.useEffect((function(){var e;null!=s&&s.application||null==s||null===(e=s.applications)||void 0===e||!e.length||P((function(e){var t;return u()(u()({},e),{},{application:null==s||null===(t=s.applications)||void 0===t?void 0:t[0]})}))}),[null==s?void 0:s.application,null==s?void 0:s.applications]),h.useMemo((function(){return!(null==s||!s.currentUser)&&[v.uU.ADMIN,v.uU.DEVELOPER].includes(s.currentUser.role)}),[null==s?void 0:s.currentUser])?(0,S.jsxs)("div",{style:{minHeight:"calc(100vh - 60px)",display:"flex",flexDirection:"row",width:"100%"},children:[(0,S.jsx)("div",{className:"sidebar",style:{width:"48px",height:"calc(100vh - 60px)",backgroundColor:"white",display:"flex",justifyContent:"center",paddingTop:12},children:(0,S.jsxs)(c.Z,{direction:"vertical",children:[(0,S.jsx)(d.Z,{placement:"right",title:"应用编排",children:(0,S.jsx)(p.ZP,{icon:(0,S.jsx)(x.Z,{}),type:t===v.z_.APPLICATION?"primary":"default",onClick:function(){I.history.push("/application/building")}})}),(0,S.jsx)(d.Z,{placement:"right",title:"数据库",children:(0,S.jsx)(p.ZP,{icon:(0,S.jsx)(j.Z,{}),type:t===v.z_.DATASOURCE?"primary":"default",onClick:function(){I.history.push("/datasources/database")}})}),(0,S.jsx)(d.Z,{placement:"right",title:"接口管理",children:(0,S.jsx)(p.ZP,{icon:(0,S.jsx)(g.Z,{}),type:t===v.z_.DATASERVICE?"primary":"default",onClick:function(){I.history.push("/datasources/dataservice")}})}),(0,S.jsx)(d.Z,{placement:"right",title:"物料库",children:(0,S.jsx)(p.ZP,{icon:(0,S.jsx)(Z.Z,{}),type:t===v.z_.MATERIALS?"primary":"default",onClick:function(){I.history.push("/materials/component")}})}),(0,S.jsx)(d.Z,{placement:"right",title:"组织架构",children:(0,S.jsx)(p.ZP,{icon:(0,S.jsx)(y.Z,{}),type:t===v.z_.ORGANIZATION?"primary":"default",onClick:function(){I.history.push("/organizations/organization")}})}),(0,S.jsx)(m.Z,{title:"权限管理",placement:"rightTop",content:(0,S.jsx)(f.Z,{style:{width:"100%",borderRight:"none"},selectedKeys:[],mode:"inline",items:[{key:"resource",label:"权限资源",icon:(0,S.jsx)(w.Z,{}),onClick:function(){I.history.push("/organizations/resource")}},{key:"role",label:"角色管理",icon:(0,S.jsx)(b.Z,{}),onClick:function(){I.history.push("/organizations/role")}}]}),children:(0,S.jsx)(p.ZP,{icon:(0,S.jsx)(C.Z,{}),type:t===v.z_.PERMISSION?"primary":"default"})}),(0,S.jsx)(d.Z,{placement:"right",title:"快捷组件-无需创建关联应用及菜单",children:(0,S.jsx)(p.ZP,{type:t===v.z_.PLAYGROUND?"primary":"default",icon:(0,S.jsx)(k.Z,{}),onClick:function(){I.history.push("/application/playground")}})}),(0,S.jsx)(d.Z,{placement:"right",title:"应用设置",children:(0,S.jsx)(p.ZP,{type:t===v.z_.SETTINGS?"primary":"default",icon:(0,S.jsx)(A.Z,{}),onClick:function(){I.history.push("/application/settings")}})})]})}),(0,S.jsx)("div",{style:{width:"calc(100vw - 60px)",padding:8,backgroundColor:"#EEE",minHeight:"calc(100vh - 120px)"},children:r}),(0,S.jsx)(E.Z,{title:"编辑应用",columns:[{name:"name",dataIndex:"name",title:"应用名称(英文)",rules:[{required:!0},{pattern:/^[a-zA-Z0-9_-]{4,32}$/,message:"4-32个字符,包含英文、数字、-、_"}]},{name:"title",dataIndex:"title",title:"应用标题",rules:[{required:!0}]},{name:"type",dataIndex:"type",title:"应用类型",widget:v.l9.SELECT,rules:[{required:!0,message:"请选择应用类型"}],options:[{label:"前端应用(Ant Design Pro)",value:v.pR.WEBAPP},{label:"后端应用(NestJS)",value:v.pR.NESTJS}]}],actionRef:D,path:"api/applications/application",saveCallback:function(){var e=l()(a()().mark((function e(t){var n,r,i;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.data,localStorage.setItem(v.Qt.APPLICATIONID,null==n?void 0:n.uuid),e.next=4,(0,T.rC)();case 4:null!=(r=e.sent)&&r.success&&r.data&&(i=r.data.find((function(e){return e.uuid===(null==n?void 0:n.uuid)})),P((function(e){return u()(u()({},e),{},{applications:r.data||[],application:i})})));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()})]}):(0,S.jsx)("div",{style:{minHeight:"calc(100vh - 60px)",display:"flex",justifyContent:"center",width:"100%"},children:(0,S.jsx)(o.ZP,{status:"403",title:"403",subTitle:"抱歉，您没有后台管理权限，请联系管理员授权开发者权限"})})}}}]);