"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[795],{52155:function(e,n,t){t.r(n),t.d(n,{default:function(){return Q}});var r=t(26068),a=t.n(r),o=t(90228),c=t.n(o),i=t(87999),s=t.n(i),l=t(48305),u=t.n(l),d=t(37956),p=t(912),f=t(14471),h=t(11204),g=t(64684),v=t(45438),m=t(50959),w=t(35363),x=t(37348),k=t(64155),C=t(7733),S=t(44817),y=t(16166),j=t(11527),_=function(e){var n=e.actionRef,t=e.successfulCallback,r=m.useState(!1),a=u()(r,2),o=a[0],i=a[1],l=m.useState(!1),d=u()(l,2),p=d[0],f=d[1];return m.useImperativeHandle(n,(function(){return{open:(e=s()(c()().mark((function e(){var n,r,a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i(!0),f(!0),e.next=4,(0,S.m3)({platform:C.eP.DINGTALK});case 4:null!=(n=e.sent)&&n.success&&n.data&&(r=(0,k.Z)(),a="".concat(window.location.protocol,"//").concat(window.location.hostname,"/user/login"),localStorage.setItem(C.Qt.LOGIN_UUID_STATE,r),localStorage.setItem(C.Qt.LOGIN_PLATFORM,C.eP.DINGTALK),(0,y.c7)("https://g.alicdn.com/dingding/h5-dingtalk-login/0.21.0/ddlogin.js",(function(){f(!1),DTFrameLogin({id:"login_dingtalk_container",width:480,height:480},{redirect_uri:encodeURIComponent(a),client_id:n.data.clientId,scope:"openid",response_type:"code",state:r,prompt:"consent"},function(){var e=s()(c()().mark((function e(n){var a,o,s,l;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f(!1),a=n.authCode,n.state!==r){e.next=7;break}return e.next=5,(0,S.b9)({code:a});case 5:null!=(o=e.sent)&&o.success&&o.data&&(localStorage.setItem(C.Qt.ACCESS_TOKEN,null===(s=o.data)||void 0===s?void 0:s.accessToken),localStorage.setItem(C.Qt.ACCESS_TOKEN_EXPIRED,null===(l=o.data)||void 0===l||null===(l=l.expired)||void 0===l?void 0:l.toString()),null==t||t(o.data),i(!1));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),(function(e){f(!1),console.log(e)}))})));case 6:case"end":return e.stop()}}),e)}))),function(){return e.apply(this,arguments)})};var e})),(0,j.jsx)(w.Z,{width:540,title:null,open:o,footer:null,destroyOnClose:!0,forceRender:!1,afterClose:function(){},onCancel:function(){return i(!1)},children:(0,j.jsx)(x.Z,{spinning:p,children:(0,j.jsx)("div",{id:"login_dingtalk_container",style:{width:480,height:480},children:(0,j.jsx)("div",{style:{width:480,height:480}})})})})},E=t(79401),I=function(e){var n=e.actionRef,t=e.successfulCallback,r=d.Z.useApp().notification,a=m.useState(!1),o=u()(a,2),i=o[0],l=o[1];return m.useImperativeHandle(n,(function(){return{open:(e=s()(c()().mark((function e(){var n,a,o;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l(!0),localStorage.setItem(C.Qt.LOGIN_PLATFORM,C.eP.WEWORK),e.next=4,(0,S.m3)({platform:C.eP.WEWORK});case 4:null!=(n=e.sent)&&n.success&&null!=n&&n.data&&(a=(0,k.Z)(),o="".concat(window.location.protocol,"//").concat(window.location.hostname,"/user/login"),(0,E.Aym)({el:"#login_wework_container",params:{appid:n.data.appid,agentid:n.data.agentid,state:a,login_type:E.RN8.corpApp,redirect_uri:o,redirect_type:E.Ht0.callback,panel_size:E.UAz.middle,lang:E.Hx4.zh},onCheckWeComLogin:function(e){var n=e.isWeComLogin;console.log(n)},onLoginSuccess:function(){var e=s()(c()().mark((function e(n){var r,a,o,i;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.code,e.next=3,(0,S.iT)({code:r});case 3:null!=(a=e.sent)&&a.success&&a.data&&(localStorage.setItem(C.Qt.ACCESS_TOKEN,null===(o=a.data)||void 0===o?void 0:o.accessToken),localStorage.setItem(C.Qt.ACCESS_TOKEN_EXPIRED,null===(i=a.data)||void 0===i||null===(i=i.expired)||void 0===i?void 0:i.toString()),null==t||t(a.data),l(!1));case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),onLoginFail:function(e){r.error({message:e.errMsg||"企业微信扫码登录错误",description:"企业微信扫码登录错误, 错误原因：".concat(e.errMsg,", 错误代码：").concat(e.errCode,"，请联系管理员")})}}));case 6:case"end":return e.stop()}}),e)}))),function(){return e.apply(this,arguments)})};var e})),(0,j.jsx)(w.Z,{width:540,title:null,open:i,footer:null,destroyOnClose:!0,forceRender:!1,afterClose:function(){},onCancel:function(){return l(!1)},children:(0,j.jsx)("div",{style:{width:480,height:480},children:(0,j.jsx)("div",{id:"login_wework_container",style:{width:480,height:480}})})})},T=t(33600);function O(e){return b.apply(this,arguments)}function b(){return(b=s()(c()().mark((function e(n){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,T.request)("/api/systems/captcha/generate",a()({method:"GET"},n||{})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var R=t(6479),P=t(2704),Z=t(52891),L=t(12322),A=t(9560),N=t(62998),W=t(72490),z=t.p+"static/background.ba3eb6f9.jpg",K=(0,v.kc)((function(){return{container:{display:"flex",flexDirection:"column",height:"100vh",overflow:"auto",backgroundImage:"url(".concat(z,")"),backgroundSize:"100% 100%"}}})),Q=function(){var e=K().styles,n=d.Z.useApp(),t=n.notification,r=n.message,o=(0,T.useSearchParams)(),i=u()(o,1)[0],l=(0,m.useState)(""),v=u()(l,2),w=v[0],x=v[1],k=(0,m.useState)(""),y=u()(k,2),E=y[0],b=y[1],z=(0,m.useState)(""),Q=u()(z,2),D=Q[0],U=Q[1],F=m.useRef(null),G=m.useRef(null),H=(0,T.useRequest)(O,{throwOnError:!0,onSuccess:function(e){e&&(b(e.svg),U(e.captchaId))}}).refresh,M=function(){var e=s()(c()().mark((function e(n){var t,r,a,o;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.redirect,r=n.token,e.next=3,(0,S.D4)();case 3:null!=(a=e.sent)&&a.success&&a.data?((o=new URL(t)).searchParams.append("token",r),window.location.replace(o)):(localStorage.removeItem(C.Qt.ACCESS_TOKEN),localStorage.removeItem(C.Qt.ACCESS_TOKEN_EXPIRED));case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return m.useEffect((function(){var e=i.get("redirect"),n=localStorage.getItem(C.Qt.ACCESS_TOKEN);e&&n&&M({redirect:e,token:n})}),[]),(0,j.jsxs)("div",{className:e.container,children:[(0,j.jsx)(T.Helmet,{children:(0,j.jsx)("title",{children:"Treadstone-登录页"})}),(0,j.jsx)("div",{style:{display:"flex",justifyContent:"center",height:"88vh"},children:(0,j.jsxs)(p.Z,{style:{width:480,marginTop:140,height:480},children:[(0,j.jsx)(N.U,{contentStyle:{minWidth:280,maxWidth:"75vw"},logo:(0,j.jsx)("img",{alt:"logo",src:"/logo.png",style:{borderRadius:6}}),title:"Treadstone",subTitle:"一个轻量的低代码应用开发平台",initialValues:{autoLogin:!0},onFinish:function(){var e=s()(c()().mark((function e(n){var o,s,l,u,d;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,o=a()(a()({},n),{},{platform:C.eP.CLIENT,captchaId:D,captchaCode:w}),e.next=4,(0,S.eG)(o);case 4:null!=(s=e.sent)&&s.success&&(r.success("登录成功！"),localStorage.setItem(C.Qt.ACCESS_TOKEN,null===(l=s.data)||void 0===l?void 0:l.accessToken),null!=(u=i.get("redirect"))&&u.startsWith("http")?((d=new URL(u)).searchParams.append("token",s.data.accessToken),window.location.replace(d)):window.location.replace("/")),t.warning({message:"错误提醒",description:s.message||"接口返回错误"}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),r.error("登录失败，请重试！");case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(n){return e.apply(this,arguments)}}(),children:(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(W.Z,{name:"username",fieldProps:{size:"large",prefix:(0,j.jsx)(R.Z,{})},placeholder:"手机号/邮箱",rules:[{required:!0,message:"请输入用户名!"}]}),(0,j.jsx)(W.Z.Password,{name:"password",fieldProps:{size:"large",prefix:(0,j.jsx)(P.Z,{})},placeholder:"密码",rules:[{required:!0,message:"请输入密码！"}]}),(0,j.jsxs)(f.Z.Compact,{style:{marginBottom:20},children:[(0,j.jsx)(h.Z,{style:{width:"60%"},size:"large",placeholder:"图形验证码",prefix:(0,j.jsx)(Z.Z,{}),value:w,onChange:function(e){x(e.target.value)}}),(0,j.jsx)(g.ZP,{style:{width:"40%",padding:1,margin:0,overflow:"hidden"},size:"large",onClick:function(){H()},children:(0,j.jsx)("div",{dangerouslySetInnerHTML:{__html:E},style:{width:"100%",height:"100%"}})})]})]})}),(0,j.jsxs)(f.Z,{size:"large",style:{width:"100%",alignItems:"center",justifyContent:"center"},children:[(0,j.jsx)(g.ZP,{size:"large",shape:"circle",icon:(0,j.jsx)(L.Z,{}),onClick:function(){var e;null===(e=G.current)||void 0===e||e.open()}},"WechatWorkOutlined"),(0,j.jsx)(g.ZP,{size:"large",shape:"circle",icon:(0,j.jsx)(A.Z,{}),onClick:function(){var e;null===(e=F.current)||void 0===e||e.open()}},"DingtalkOutlined")]})]})}),(0,j.jsx)(_,{actionRef:F,successfulCallback:function(e){var n=i.get("redirect");if(null!=n&&n.startsWith("http")){var t=new URL(n);t.searchParams.append("token",e.accessToken),window.location.replace(t)}else window.location.replace(n||"/")}}),(0,j.jsx)(I,{actionRef:G,successfulCallback:function(e){var n=i.get("redirect");if(null!=n&&n.startsWith("http")){var t=new URL(n);t.searchParams.append("token",e.accessToken),window.location.replace(t)}else window.location.replace(n||"/")}})]})}},16166:function(e,n,t){t.d(n,{XV:function(){return u},c7:function(){return f},e7:function(){return p},kL:function(){return d},pM:function(){return l}});var r=t(335),a=t.n(r),o=t(26068),c=t.n(o),i=t(82092),s=t.n(i),l=function(e){try{return JSON.parse(e),!0}catch(e){return!1}},u=function(e){var n;return/[A-Za-z]/.test(null==e?void 0:e.substring(0,1))?null==e||null===(n=e.substring(0,1))||void 0===n?void 0:n.toUpperCase():null==e?void 0:e.substring(0,1)},d=function(e){return Object.keys(e).reduce((function(n,t){return null!==e[t]&&""!==e[t]?Object.assign(n,s()({},t,e[t])):n}),{})},p=function(e,n){var t,r=c()({},e),o=a()(n);try{for(o.s();!(t=o.n()).done;){var i=t.value;r.hasOwnProperty(i)&&delete r[i]}}catch(e){o.e(e)}finally{o.f()}return r},f=function(e,n){var t=document.createElement("script");t.type="text/javascript",t.src=e,t.onload=function(){console.log("Script loaded: ".concat(e)),n&&n()},t.onerror=function(){console.error("Failed to load script: ".concat(e))},document.head.appendChild(t)}}}]);