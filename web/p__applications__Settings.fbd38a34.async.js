"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[120],{20947:function(e,n,t){var l=t(57904),a=t(99459),r=t(53162),i=t(69501),o=t(81517),u=t(98037),d=t(73115),c=t(83036),s=t(26314),p=t(67413),v=t(92629),f=t(38801),h=t(41751),m=t(44193),x=t(64684),g=t(47113),b=t(74276),Z=t(75124),y=t(6496),I=t(50959),j=t(28117),w=t(11527),C=["onTableChange","maxLength","formItemProps","recordCreatorProps","rowKey","controlled","defaultValue","onChange","editableFormRef"],R=["record","position","creatorButtonText","newRecordType","parentKey","style"],S=I.createContext(void 0);function T(e){var n,t=e.children,l=e.record,a=e.position,r=e.newRecordType,d=e.parentKey,c=(0,I.useContext)(S);return I.cloneElement(t,(0,u.Z)((0,u.Z)({},t.props),{},{onClick:(n=(0,o.Z)((0,i.Z)().mark((function e(n){var o,u,s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(o=(u=t.props).onClick)||void 0===o?void 0:o.call(u,n);case 2:if(!1!==e.sent){e.next=5;break}return e.abrupt("return");case 5:null==c||null===(s=c.current)||void 0===s||s.addEditRecord(l,{position:a,newRecordType:r,parentKey:d});case 6:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})}))}function E(e){var n,t,i=(0,p.YB)(),o=e.onTableChange,s=e.maxLength,g=(e.formItemProps,e.recordCreatorProps),E=e.rowKey,P=(e.controlled,e.defaultValue),V=(e.onChange,e.editableFormRef),k=(0,r.Z)(e,C),O=(0,I.useRef)(void 0),A=(0,I.useRef)(),F=(0,I.useRef)();(0,I.useImperativeHandle)(k.actionRef,(function(){return A.current}),[A.current]);var K=(0,b.Z)((function(){return e.value||P||[]}),{value:e.value,onChange:e.onChange}),Y=(0,a.Z)(K,2),D=Y[0],N=Y[1],M=I.useMemo((function(){return"function"==typeof E?E:function(e,n){return e[E]||n}}),[E]),z=(0,v.J)((function(n){if("number"==typeof n&&!e.name){if(n>=D.length)return n;var t=D&&D[n];return null==M?void 0:M(t,n)}if(("string"==typeof n||n>=D.length)&&e.name){var l=D.findIndex((function(e,t){var l;return(null==M||null===(l=M(e,t))||void 0===l?void 0:l.toString())===(null==n?void 0:n.toString())}));if(-1!==l)return l}return n}));(0,I.useImperativeHandle)(V,(function(){var n=function(n){var t,l;if(null==n)throw new Error("rowIndex is required");var a=z(n),r=[e.name,null!==(t=null==a?void 0:a.toString())&&void 0!==t?t:""].flat(1).filter(Boolean);return null===(l=F.current)||void 0===l?void 0:l.getFieldValue(r)};return(0,u.Z)((0,u.Z)({},F.current),{},{getRowData:n,getRowsData:function(){var n,t=[e.name].flat(1).filter(Boolean);if(Array.isArray(t)&&0===t.length){var l,a=null===(l=F.current)||void 0===l?void 0:l.getFieldsValue();return Array.isArray(a)?a:Object.keys(a).map((function(e){return a[e]}))}return null===(n=F.current)||void 0===n?void 0:n.getFieldValue(t)},setRowData:function(t,l){var a,r;if(null==t)throw new Error("rowIndex is required");var i=z(t),o=[e.name,null!==(a=null==i?void 0:i.toString())&&void 0!==a?a:""].flat(1).filter(Boolean),d=Object.assign({},(0,u.Z)((0,u.Z)({},n(t)),l||{})),c=(0,y.Z)({},o,d);return null===(r=F.current)||void 0===r||r.setFieldsValue(c),!0}})}),[z,e.name,F.current]),(0,I.useEffect)((function(){e.controlled&&(D||[]).forEach((function(e,n){var t;null===(t=F.current)||void 0===t||t.setFieldsValue((0,l.Z)({},"".concat(M(e,n)),e))}),{})}),[(0,f.ZP)(D),e.controlled]),(0,I.useEffect)((function(){var n;e.name&&(F.current=null==e||null===(n=e.editable)||void 0===n?void 0:n.form)}),[null===(n=e.editable)||void 0===n?void 0:n.form,e.name]);var B=g||{},L=B.record,q=B.position,J=B.creatorButtonText,_=B.newRecordType,H=B.parentKey,U=B.style,W=(0,r.Z)(B,R),G="top"===q,X=(0,I.useMemo)((function(){return!("number"==typeof s&&s<=(null==D?void 0:D.length))&&(!1!==g&&(0,w.jsx)(T,{record:(0,h.h)(L,null==D?void 0:D.length,D)||{},position:q,parentKey:(0,h.h)(H,null==D?void 0:D.length,D),newRecordType:_,children:(0,w.jsx)(x.ZP,(0,u.Z)((0,u.Z)({type:"dashed",style:(0,u.Z)({display:"block",margin:"10px 0",width:"100%"},U),icon:(0,w.jsx)(d.Z,{})},W),{},{children:J||i.getMessage("editableTable.action.add","添加一行数据")}))}))}),[g,s,null==D?void 0:D.length]),Q=(0,I.useMemo)((function(){return X?G?{components:{header:{wrapper:function(e){var n,t=e.className,l=e.children;return(0,w.jsxs)("thead",{className:t,children:[l,(0,w.jsxs)("tr",{style:{position:"relative"},children:[(0,w.jsx)("td",{colSpan:0,style:{visibility:"hidden"},children:X}),(0,w.jsx)("td",{style:{position:"absolute",left:0,width:"100%"},colSpan:null===(n=k.columns)||void 0===n?void 0:n.length,children:X})]})]})}}}}:{tableViewRender:function(n,t){var l,a;return(0,w.jsxs)(w.Fragment,{children:[null!==(l=null===(a=e.tableViewRender)||void 0===a?void 0:a.call(e,n,t))&&void 0!==l?l:t,X]})}}:{}}),[G,X]),$=(0,u.Z)({},e.editable),ee=(0,v.J)((function(n,t){var l,a,r,i;(null===(l=e.editable)||void 0===l||null===(a=l.onValuesChange)||void 0===a||a.call(l,n,t),null===(r=e.onValuesChange)||void 0===r||r.call(e,t,n),e.controlled)&&(null==e||null===(i=e.onChange)||void 0===i||i.call(e,t))}));return(null!=e&&e.onValuesChange||null!==(t=e.editable)&&void 0!==t&&t.onValuesChange||e.controlled&&null!=e&&e.onChange)&&($.onValuesChange=ee),(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(S.Provider,{value:A,children:(0,w.jsx)(j.Z,(0,u.Z)((0,u.Z)((0,u.Z)({search:!1,options:!1,pagination:!1,rowKey:E,revalidateOnFocus:!1},k),Q),{},{tableLayout:"fixed",actionRef:A,onChange:o,editable:(0,u.Z)((0,u.Z)({},$),{},{formProps:(0,u.Z)({formRef:F},$.formProps)}),dataSource:D,onDataSourceChange:function(n){if(N(n),e.name&&"top"===q){var t,l=(0,y.Z)({},[e.name].flat(1).filter(Boolean),n);null===(t=F.current)||void 0===t||t.setFieldsValue(l)}}}))}),e.name?(0,w.jsx)(c.Z,{name:[e.name],children:function(n){var t,l;if(!O.current)return O.current=D,null;var a=(0,Z.Z)(n,[e.name].flat(1)),r=null==a?void 0:a.find((function(e,n){var t;return!(0,m.A)(e,null===(t=O.current)||void 0===t?void 0:t[n])}));return O.current=D,r?(null==e||null===(t=e.editable)||void 0===t||null===(l=t.onValuesChange)||void 0===l||l.call(t,r,a),null):null}}):null]})}function P(e){var n=s.ZP.useFormInstance();return e.name?(0,w.jsx)(g.Z.Item,(0,u.Z)((0,u.Z)({style:{maxWidth:"100%"}},null==e?void 0:e.formItemProps),{},{name:e.name,shouldUpdate:function(n,t){var l=[e.name].flat(1);try{return JSON.stringify((0,Z.Z)(n,l))!==JSON.stringify((0,Z.Z)(t,l))}catch(e){return!0}},children:(0,w.jsx)(E,(0,u.Z)((0,u.Z)({},e),{},{editable:(0,u.Z)((0,u.Z)({},e.editable),{},{form:n})}))})):(0,w.jsx)(E,(0,u.Z)({},e))}P.RecordCreator=T,n.Z=P},38734:function(e,n,t){t.r(n);var l=t(82092),a=t.n(l),r=t(90228),i=t.n(r),o=t(87999),u=t.n(o),d=t(26068),c=t.n(d),s=t(48305),p=t.n(s),v=t(37956),f=t(70725),h=t(73264),m=t(912),x=t(21621),g=t(14471),b=t(64684),Z=t(91283),y=t(60247),I=t(74230),j=t(50959),w=t(38653),C=t(81796),R=t(7733),S=t(28213),T=t(10218),E=t(73115),P=t(7313),V=t(20947),k=t(33600),O=t(11527);n.default=function(){var e,n,t,l,r,o=v.Z.useApp().message,d=j.useRef(),s=(0,k.useModel)("@@initialState"),A=s.initialState,F=s.setInitialState,K=j.useState(),Y=p()(K,2),D=Y[0],N=Y[1],M=j.useState([]),z=p()(M,2),B=z[0],L=z[1],q=j.useState([]),J=p()(q,2),_=J[0],H=J[1],U=j.useState(!1),W=p()(U,2),G=W[0],X=W[1],Q=j.useRef(),$=(0,k.useRequest)(T.EX,{defaultParams:[{applicationId:null==A||null===(e=A.application)||void 0===e?void 0:e.id}],onSuccess:function(e){L(e||[])}}),ee=$.loading,ne=$.refresh,te=$.run;return j.useEffect((function(){var e;null!=A&&A.application||null==A||null===(e=A.applications)||void 0===e||!e.length||F((function(e){var n;return c()(c()({},e),{},{application:null==A||null===(n=A.applications)||void 0===n?void 0:n[0]})})),null!=A&&A.application&&N(A.application)}),[null==A?void 0:A.application,null==A?void 0:A.applications]),(0,O.jsxs)(S.Z,{activateKey:R.z_.SETTINGS,actionRef:d,children:[D?(0,O.jsxs)(f.Z,{children:[(0,O.jsx)(h.Z,{span:4,style:{paddingRight:6},children:(0,O.jsx)(m.Z,{title:"应用列表",styles:{body:{padding:12,height:"83vh",overflowY:"auto"}},children:(0,O.jsx)(x.Z,{mode:"inline",style:{width:"100%",borderRight:"none"},selectedKeys:D?[null==D?void 0:D.appId]:[],items:null==A||null===(n=A.applications)||void 0===n?void 0:n.map((function(e){return{key:e.appId,label:e.name}})),onSelect:function(e){var n,t=e.key,l=null==A||null===(n=A.applications)||void 0===n?void 0:n.find((function(e){return e.appId===t}));N(l),te({applicationId:null==l?void 0:l.id})}})})}),(0,O.jsx)(h.Z,{span:20,children:(0,O.jsxs)(g.Z,{direction:"vertical",children:[(0,O.jsx)(m.Z,{title:"应用信息",children:(0,O.jsxs)(P.vY,{editable:{onSave:(r=u()(i()().mark((function e(n,t){var l;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,T.up)(c()({id:null==D?void 0:D.id},t));case 2:null!=(l=e.sent)&&l.success&&o.success("保存成功");case 4:case"end":return e.stop()}}),e)}))),function(e,n){return r.apply(this,arguments)})},children:[(0,O.jsx)(P.vY.Item,{label:"应用名称",dataIndex:"name",editable:!1,children:null==D?void 0:D.name}),(0,O.jsx)(P.vY.Item,{label:"应用标题",dataIndex:"title",children:null==D?void 0:D.title}),(0,O.jsx)(P.vY.Item,{label:"应用域名",tooltip:"垮应用交互时需要，填写请带上http/https",dataIndex:"domain",children:null==D?void 0:D.domain}),(0,O.jsx)(P.vY.Item,{label:"回调路径",tooltip:"审批、任务状态变更回调路径",dataIndex:"callbackPath",children:null==D?void 0:D.callbackPath}),(0,O.jsx)(P.vY.Item,{label:"应用类型",editable:!1,dataIndex:"type",valueEnum:a()(a()({},R.pR.WEBAPP,"前端应用(Ant Design Pro)"),R.pR.NESTJS,"后端应用(Nestjs)"),children:null==D?void 0:D.type}),(0,O.jsx)(P.vY.Item,{label:"发布状态",tooltip:"发布后跨应用才能跳转",dataIndex:"published",valueEnum:new Map([[!0,"发布"],[!1,"下架"]]),children:null==D?void 0:D.published}),(0,O.jsx)(P.vY.Item,{label:"创建时间",valueType:"dateTime",dataIndex:"created",editable:!1,children:null==A||null===(t=A.organization)||void 0===t?void 0:t.created}),(0,O.jsx)(P.vY.Item,{label:"应用ID",copyable:!0,editable:!1,children:null==D?void 0:D.appId}),(0,O.jsx)(P.vY.Item,{label:"应用密钥",copyable:!0,editable:!1,children:null==D?void 0:D.appSecret})]})}),(0,O.jsx)(m.Z,{title:"应用成员",loading:ee,extra:(0,O.jsx)(b.ZP,{type:"primary",icon:(0,O.jsx)(E.Z,{}),onClick:function(){var e;null===(e=Q.current)||void 0===e||e.callCreateView({values:{role:"VISITOR"},params:{applicationId:null==D?void 0:D.id}})},children:"添加成员"}),children:(0,O.jsx)(V.Z,{size:"small",loading:ee,columns:[{title:"名称",dataIndex:"name",editable:!1},{title:"邮箱",dataIndex:"email",editable:!1},{title:"角色",dataIndex:"role",valueEnum:{VISITOR:"访问者",DEVELOPER:"开发者",ADMINISTRATOR:"管理员"}},{title:"添加时间",dataIndex:"created",valueType:"dateTime",editable:!1},{title:"操作",valueType:"option",width:160,render:function(e,n,t,l){return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(b.ZP,{type:"link",size:"small",onClick:function(){var e;null==l||null===(e=l.startEditable)||void 0===e||e.call(l,n.uuid)},children:"编辑"},"editable"),(0,O.jsx)(Z.Z,{title:"确认将该成员从应用参与人员中移除吗？",onConfirm:u()(i()().mark((function e(){var t;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return X(!0),e.next=3,(0,T.EH)({id:n.id});case 3:t=e.sent,X(!1),null!=t&&t.success&&ne();case 6:case"end":return e.stop()}}),e)}))),onCancel:function(){},children:(0,O.jsx)(b.ZP,{danger:!0,type:"link",size:"small",loading:G,children:"删除"},"delete")})]})}}],value:B,onChange:L,rowKey:function(e){return e.uuid},recordCreatorProps:!1,editable:{type:"single",editableKeys:_,onChange:H,actionRender:function(e,n,t){return[t.save,t.cancel]},onValuesChange:function(e,n){L(n)},onSave:(l=u()(i()().mark((function e(n,t){var l,a,r;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=t.id,a=t.role,e.next=3,(0,T.CO)({where:{id:l},data:{role:a}});case 3:null!=(r=e.sent)&&r.success&&o.success("保存成功");case 5:case"end":return e.stop()}}),e)}))),function(e,n){return l.apply(this,arguments)})}})})]})})]}):(0,O.jsx)(m.Z,{style:{height:"83vh"},bordered:!1,children:(0,O.jsx)(y.Z,{image:"https://gw.alipayobjects.com/zos/antfincdn/ZHrcdLPrvN/empty.svg",imageStyle:{height:60},description:(0,O.jsx)(I.Z.Text,{strong:!0,children:"还没有应用，请先创建一个吧"}),children:(0,O.jsx)(b.ZP,{size:"large",type:"primary",icon:(0,O.jsx)(E.Z,{}),onClick:function(){var e;null===(e=d.current)||void 0===e||e.callAppCreateView()},children:"创建应用"})})}),(0,O.jsx)(w.Z,{}),(0,O.jsx)(C.Z,{title:"添加应用成员",columns:[{name:"memberId",dataIndex:"memberId",title:"选择成员",rules:[{required:!0}],widget:R.l9.AUTOCOMPLETE,reference:{method:"POST",path:"api/organizations/member/list"}},{name:"role",dataIndex:"role",title:"角色",widget:R.l9.SELECT,rules:[{required:!0,message:"请选择应用成员角色"}],options:[{label:"访问者",value:"VISITOR"},{label:"开发者",value:"DEVELOPER"},{label:"管理员",value:"ADMINISTRATOR"}]}],actionRef:Q,path:"api/applications/member/create",saveCallback:function(){ne()}})]})}}}]);