"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[211],{88113:function(e,t,n){n.r(t),n.d(t,{default:function(){return M}});var a=n(90228),r=n.n(a),i=n(87999),u=n.n(i),s=n(48305),o=n.n(s),l=n(70725),c=n(73264),d=n(912),p=n(31331),f=n(64684),x=n(21621),m=n(74230),v=n(22825),h=n(60247),g=n(11204),y=n(50959),Z=n(38653),j=n(81796),b=n(7733),w=n(28213),k=n(52883),C=n(20370),I=n(73115),P=n(5135),R=n(70346),S=n(41778),L=n(21686),q=n(28117),T=n(33600),E=n(17906),N=n(37348),z=n(11527),A=function(e){var t=e.actionRef,n=(0,y.useState)(!1),a=o()(n,2),r=a[0],i=a[1],u=(0,y.useState)(),s=o()(u,2),l=s[0],c=s[1],d=(0,T.useRequest)(C.CX,{manual:!0}),p=d.data,f=d.loading,x=d.run;return y.useImperativeHandle(t,(function(){return{open:function(e){i(!0),c(e),x(e)}}})),(0,z.jsx)(E.Z,{width:1200,title:"".concat(null==l?void 0:l.tableName," 表字段"),open:r,onClose:function(){i(!1)},children:(0,z.jsx)(N.Z,{spinning:f,children:(0,z.jsx)(q.Z,{rowKey:"columnName",dataSource:p,search:!1,toolBarRender:!1,tableAlertRender:!1,pagination:!1,columns:[{dataIndex:"columnName",title:"字段名"},{dataIndex:"dataType",title:"类型"},{dataIndex:"columnComment",title:"备注",ellipsis:!0},{dataIndex:"columnDefault",title:"默认值"},{dataIndex:"characterMaximumLength",title:"长度"},{dataIndex:"numericPrecision",title:"精度"},{dataIndex:"numericScale",title:"小数位"},{dataIndex:"unique",title:"唯一主键",render:function(e){return"TRUE"===e?"是":"否"}},{dataIndex:"nullable",title:"允许空值",render:function(e){return"TRUE"===e?"是":"否"}}]})})})},M=function(){var e,t=y.useState(),n=o()(t,2),a=n[0],i=n[1],s=y.useState(""),E=o()(s,2),N=E[0],M=E[1],O=y.useRef(),Q=y.useRef(),_=y.useRef(),K=(0,T.useRequest)(k.r$,{manual:!0,onSuccess:(e=u()(r()().mark((function e(t){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(null==t?void 0:t.length)>0&&i(t[0]);case 1:case"end":return e.stop()}}),e)}))),function(t){return e.apply(this,arguments)})}),U=K.data,Y=K.refresh,B=K.run,D=K.loading;return y.useEffect((function(){B()}),[]),(0,z.jsx)(w.Z,{activateKey:b.z_.DATASOURCE,children:(0,z.jsxs)(z.Fragment,{children:[(0,z.jsxs)(l.Z,{children:[(0,z.jsx)(c.Z,{span:4,style:{paddingRight:6},children:(0,z.jsx)(d.Z,{title:"数据库",loading:D,styles:{body:{padding:12,height:"83vh",overflowY:"auto"}},extra:(0,z.jsx)(p.Z,{title:"新增数据库",children:(0,z.jsx)(f.ZP,{type:"primary",icon:(0,z.jsx)(I.Z,{}),onClick:function(){var e;null===(e=_.current)||void 0===e||e.callCreateView({values:{type:"MYSQL"}})}})}),children:(null==U?void 0:U.length)>0?(0,z.jsx)(x.Z,{style:{width:"100%",borderRight:"none"},selectedKeys:a?[a.uuid]:[],mode:"inline",items:null==U?void 0:U.map((function(e){return{style:{padding:12},label:(0,z.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,z.jsx)(m.Z.Text,{strong:!0,children:e.title})," ",(0,z.jsx)(v.Z,{trigger:["click"],menu:{items:[{label:"编辑",key:"edit",icon:(0,z.jsx)(P.Z,{}),onClick:function(t){var n;t.domEvent.stopPropagation(),null===(n=_.current)||void 0===n||n.callUpdateView({record:e})}},{label:"删除",danger:!0,key:"delete",icon:(0,z.jsx)(R.Z,{}),onClick:(n=u()(r()().mark((function t(n){var u;return r()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.domEvent.stopPropagation(),t.next=4,(0,C.r1)({datasource:null==e?void 0:e.id});case 4:null!=(u=t.sent)&&u.success&&(Y(),e.uuid===(null==a?void 0:a.uuid)&&i(void 0));case 6:case"end":return t.stop()}}),t)}))),function(e){return n.apply(this,arguments)})}]},children:(0,z.jsx)(f.ZP,{size:"small",color:"default",variant:"filled",icon:(0,z.jsx)(S.Z,{style:{fontSize:16}}),onClick:function(e){e.stopPropagation()}})},"options")]}),key:e.uuid,onClick:(t=u()(r()().mark((function t(){return r()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i(e);case 1:case"end":return t.stop()}}),t)}))),function(){return t.apply(this,arguments)})};var t,n}))}):(0,z.jsx)(h.Z,{image:"https://gw.alipayobjects.com/zos/antfincdn/ZHrcdLPrvN/empty.svg",imageStyle:{height:60},description:(0,z.jsx)(m.Z.Text,{strong:!0,children:"还没有数据库连接，请先创建一个吧"}),children:(0,z.jsx)(f.ZP,{type:"primary",icon:(0,z.jsx)(I.Z,{}),onClick:function(){var e;null===(e=_.current)||void 0===e||e.callCreateView({values:{type:"MYSQL"}})},children:"新建数据库连接"})})})}),(0,z.jsx)(c.Z,{span:20,children:(0,z.jsx)(d.Z,{title:"数据库表",styles:{body:{padding:12,height:"83vh",overflowY:"auto"}},extra:(0,z.jsx)(g.Z.Search,{value:N,style:{width:360},placeholder:"表名/备注",enterButton:(0,z.jsx)(f.ZP,{type:"primary",icon:(0,z.jsx)(L.Z,{})}),onChange:function(e){return M(e.target.value)}}),children:a?(0,z.jsx)(q.Z,{size:"small",rowKey:"uuid",actionRef:O,tableAlertOptionRender:!1,toolBarRender:!1,tableAlertRender:!1,search:!1,params:{keyword:N,datasourceId:null==a?void 0:a.id},pagination:{pageSize:18},request:function(){var e=u()(r()().mark((function e(t){var n,a,i,u;return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.keyword,a=t.datasourceId,e.next=3,(0,C.rn)(a);case 3:if(i=e.sent,!n){e.next=6;break}return e.abrupt("return",{data:(null==i||null===(u=i.data)||void 0===u?void 0:u.filter((function(e){return e.tableName.toLowerCase().indexOf(n.toLowerCase())>-1||e.comment.toLowerCase().indexOf(n.toLowerCase())>-1})))||[]});case 6:return e.abrupt("return",{data:(null==i?void 0:i.data)||[],success:!0});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),columns:[{title:"表名",dataIndex:"tableName",copyable:!0},{title:"备注",dataIndex:"comment"},{title:"数据大小",dataIndex:"dataLength"},{title:"行数",dataIndex:"tableRows"},{title:"引擎类型",dataIndex:"engine"},{title:"操作",valueType:"option",width:120,render:function(e,t){return(0,z.jsx)(z.Fragment,{children:(0,z.jsx)(f.ZP,{type:"link",size:"small",onClick:function(){var e;a&&(null===(e=Q.current)||void 0===e||e.open({datasource:a.id,tableName:t.tableName}))},children:"查看表字段"})})}}]}):(0,z.jsx)(h.Z,{})})})]}),(0,z.jsx)(Z.Z,{}),(0,z.jsx)(A,{actionRef:Q}),(0,z.jsx)(j.Z,{title:"编辑数据库连接",columns:[{name:"title",dataIndex:"title",title:"标题",rules:[{required:!0}]},{name:"database",dataIndex:"database",title:"数据库名",rules:[{required:!0}]},{name:"host",dataIndex:"host",title:"HOST",rules:[{required:!0}]},{name:"username",dataIndex:"username",title:"USERNAME",rules:[{required:!0}]},{name:"password",dataIndex:"password",title:"PASSWORD",rules:[{required:!0}]},{name:"type",dataIndex:"type",title:"数据库类型",widget:b.l9.SELECT,rules:[{required:!0,message:"请选择应用类型"}],options:[{label:"MySQL",value:"MYSQL"},{label:"PostgreSQL",value:"PGSQL"}]}],actionRef:_,path:"api/datasources/database",saveCallback:function(){Y()}})]})})}},20370:function(e,t,n){n.d(t,{B$:function(){return l},CX:function(){return f},FT:function(){return v},FW:function(){return c},KR:function(){return d},Lk:function(){return x},_j:function(){return o},r$:function(){return s},r1:function(){return h},rn:function(){return p},yv:function(){return m}});var a=n(67825),r=n.n(a),i=n(92447),u=["datasource"],s=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i.ZP.post("api/datasources/database/list",e)},o=function(){return i.ZP.post("api/datasources/service-group/list")},l=function(e){return i.ZP.post("api/datasources/service-group",e)},c=function(e){return i.ZP.delete("api/datasources/service-group/".concat(e))},d=function(e){return i.ZP.post("api/datasources/dataservice/page",e)},p=function(e){return i.ZP.get("api/datasources/database/".concat(e,"/queryDatabaseTables/"))},f=function(e){var t=e.datasource,n=r()(e,u);return i.ZP.get("api/datasources/database/".concat(t,"/queryTableColumns/"),n)},x=function(e){return i.ZP.get("api/datasources/dataservice/".concat(e))},m=function(e,t){return i.ZP.post("api/datasources/service-group/".concat(e,"/migrate"),t)},v=function(e){return i.ZP.post("api/datasources/dataschema/list",e)},h=function(e){var t=e.datasource;return i.ZP.delete("api/datasources/database/".concat(t))}}}]);