"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[446],{89862:function(e,n,t){t.d(n,{Z:function(){return l}});var r=t(2053),a=t(50959),i={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M136 552h63.6c4.4 0 8-3.6 8-8V288.7h528.6v72.6c0 1.9.6 3.7 1.8 5.2a8.3 8.3 0 0011.7 1.4L893 255.4c4.3-5 3.6-10.3 0-13.2L749.7 129.8a8.22 8.22 0 00-5.2-1.8c-4.6 0-8.4 3.8-8.4 8.4V209H199.7c-39.5 0-71.7 32.2-71.7 71.8V544c0 4.4 3.6 8 8 8zm752-80h-63.6c-4.4 0-8 3.6-8 8v255.3H287.8v-72.6c0-1.9-.6-3.7-1.8-5.2a8.3 8.3 0 00-11.7-1.4L131 768.6c-4.3 5-3.6 10.3 0 13.2l143.3 112.4c1.5 1.2 3.3 1.8 5.2 1.8 4.6 0 8.4-3.8 8.4-8.4V815h536.6c39.5 0 71.7-32.2 71.7-71.8V480c-.2-4.4-3.8-8-8.2-8z"}}]},name:"retweet",theme:"outlined"},o=t(58714),s=function(e,n){return a.createElement(o.Z,(0,r.Z)({},e,{ref:n,icon:i}))};var l=a.forwardRef(s)},39821:function(e,n,t){var r=t(90228),a=t.n(r),i=t(87999),o=t.n(i),s=t(48305),l=t.n(s),u=t(47113),c=t(37956),d=t(35363),p=t(64684),f=t(11204),v=t(50959),m=t(20370),h=t(16166),x=t(11527);n.Z=function(e){var n=e.submitCallback,t=e.actionRef,r=u.Z.useForm(),i=l()(r,1)[0],s=c.Z.useApp().message,g=(0,v.useState)(!1),y=l()(g,2),j=y[0],Z=y[1],b=(0,v.useState)(),w=l()(b,2),k=w[0],C=w[1];return(0,v.useImperativeHandle)(t,(function(){return{open:function(e){var n=e.group;C(n),Z(!0)}}})),(0,x.jsx)(d.Z,{width:800,title:"编辑接口项目",destroyOnClose:!0,open:j,onCancel:function(){Z(!1)},afterClose:function(){i.resetFields()},footer:(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(p.ZP,{onClick:function(){Z(!1)},children:"取消"}),(0,x.jsx)(p.ZP,{type:"primary",onClick:o()(a()().mark((function e(){var t,r,o;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.validateFields();case 2:if(t=e.sent,!k||!t.config){e.next=9;break}return r=JSON.parse(t.config),e.next=7,(0,m.yv)(k.id,r);case 7:(o=e.sent)&&o.success&&(s.success("保存成功"),Z(!1),null==n||n());case 9:case"end":return e.stop()}}),e)}))),children:"提交"})]}),children:(0,x.jsx)(u.Z,{form:i,labelCol:{span:0},wrapperCol:{span:24},children:(0,x.jsx)(u.Z.Item,{label:"",name:"config",rules:[{required:!0,message:"请输入Swagger配置JSON"},{validator:function(e,n){return(0,h.pM)(n)?Promise.resolve():Promise.reject(new Error("请输入合法的JSON"))},message:"请输入合法的JSON"}],children:(0,x.jsx)(f.Z.TextArea,{rows:24,placeholder:"JSON Content..."})})})})}},11172:function(e,n,t){t.r(n),t.d(n,{default:function(){return X}});var r=t(67825),a=t.n(r),i=t(90228),o=t.n(i),s=t(87999),l=t.n(s),u=t(48305),c=t.n(u),d=t(70725),p=t(73264),f=t(912),v=t(31331),m=t(64684),h=t(21621),x=t(74230),g=t(22825),y=t(56655),j=t(60247),Z=t(11204),b=t(50959),w=t(26068),k=t.n(w),C=t(17906),S=t(28117),I=t(11527),P=function(e){var n=e.actionRef,t=(0,b.useState)(!1),r=c()(t,2),a=r[0],i=r[1],o=(0,b.useState)(),s=c()(o,2),l=s[0],u=s[1];b.useImperativeHandle(n,(function(){return{open:function(e){i(!0),u(e)}}}));var d=b.useMemo((function(){return null!=l&&l.properties?Object.entries(null==l?void 0:l.properties).map((function(e){var n=c()(e,2),t=n[0],r=n[1];return k()({name:t},r||{})})):[]}),[l]);return(0,I.jsx)(I.Fragment,{children:(0,I.jsx)(C.Z,{width:1e3,title:(null==l?void 0:l.name)||"接口对象详情",zIndex:300,destroyOnClose:!0,maskClosable:!0,open:a,onClose:function(){i(!1)},footer:null,children:(0,I.jsx)(S.Z,{rowKey:"name",size:"small",tableAlertOptionRender:!1,tableAlertRender:!1,toolBarRender:!1,dataSource:d||[],search:!1,pagination:!1,columns:[{title:"标题",dataIndex:"title",copyable:!0},{title:"属性名",dataIndex:"name",copyable:!0},{title:"类型",dataIndex:"type",render:function(e,n){if(n.allOf)return n.allOf.map((function(e){var n,t=null===(n=e.$ref)||void 0===n||null===(n=n.split("/"))||void 0===n?void 0:n.at(-1);return(0,I.jsx)(m.ZP,{type:"link",size:"small",style:{paddingLeft:0},children:t},t)}));if(n.items){if(n.items.$ref){var t,r=null===(t=n.items.$ref.split("/"))||void 0===t?void 0:t.at(-1);return(0,I.jsx)(m.ZP,{type:"link",size:"small",style:{paddingLeft:0},children:"".concat(r,"[]")})}return"".concat(n.items.type,"[]")}return n.type}},{title:"描述",dataIndex:"description"},{title:"枚举值",dataIndex:"enum",render:function(e,n){var t;return n.enum?null===(t=n.enum)||void 0===t?void 0:t.join(","):null}},{title:"默认值",dataIndex:"default",render:function(e,n){return n.default||"-"}}]})})})},O=t(33600);function R(e,n){return z.apply(this,arguments)}function z(){return(z=l()(o()().mark((function e(n,t){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,O.request)("/api/datasources/dataschema/findone",k()({method:"POST",headers:{"Content-Type":"application/json"},data:n},t||{})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var N=function(e){var n=e.actionRef,t=(0,b.useState)(!1),r=c()(t,2),a=r[0],i=r[1],s=(0,b.useState)(),u=c()(s,2),d=u[0],p=u[1],f=b.useRef();b.useImperativeHandle(n,(function(){return{open:function(e){i(!0),p(e)}}}));var v=b.useMemo((function(){return null!=d&&d.properties?Object.entries(null==d?void 0:d.properties).map((function(e){var n=c()(e,2),t=n[0],r=n[1];return k()({name:t},r||{})})):[]}),[d]);return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(C.Z,{width:1200,title:(null==d?void 0:d.name)||"接口对象详情",zIndex:299,destroyOnClose:!0,maskClosable:!0,open:a,onClose:function(){i(!1)},footer:null,children:(0,I.jsx)(S.Z,{rowKey:"name",size:"small",tableAlertOptionRender:!1,tableAlertRender:!1,toolBarRender:!1,dataSource:v||[],search:!1,pagination:!1,columns:[{title:"标题",dataIndex:"title",copyable:!0},{title:"属性名",dataIndex:"name",copyable:!0},{title:"类型",dataIndex:"type",render:function(e,n){if(n.allOf)return n.allOf.map((function(e){var n,t=null===(n=e.$ref)||void 0===n||null===(n=n.split("/"))||void 0===n?void 0:n.at(-1);return(0,I.jsx)(m.ZP,{type:"link",size:"small",style:{paddingLeft:0},onClick:l()(o()().mark((function e(){var n,r;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R({name:t,groupId:null==d?void 0:d.groupId});case 2:null!=(n=e.sent)&&n.success&&n.data&&(null===(r=f.current)||void 0===r||r.open(n.data));case 4:case"end":return e.stop()}}),e)}))),children:t},t)}));if(n.items){if(n.items.$ref){var t,r=null===(t=n.items.$ref.split("/"))||void 0===t?void 0:t.at(-1);return(0,I.jsx)(m.ZP,{type:"link",size:"small",style:{paddingLeft:0},onClick:l()(o()().mark((function e(){var n,t;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R({name:r,groupId:null==d?void 0:d.groupId});case 2:null!=(n=e.sent)&&n.success&&n.data&&(null===(t=f.current)||void 0===t||t.open(n.data));case 4:case"end":return e.stop()}}),e)}))),children:"".concat(r,"[]")})}return"".concat(n.items.type,"[]")}return n.type}},{title:"描述",dataIndex:"description"},{title:"枚举值",dataIndex:"enum",render:function(e,n){var t;return n.enum?null===(t=n.enum)||void 0===t?void 0:t.join(","):null}},{title:"默认值",dataIndex:"default",render:function(e,n){return n.default||"-"}}]})}),(0,I.jsx)(P,{actionRef:f})]})},F=t(39821),L=t(7733),J=t(28213),V=t(20370),q=t(16166),A=t(73115),$=t(89862),K=t(5135),B=t(70346),T=t(41778),M=t(21686),H=t(47113),_=t(35363),E=t(45144),U=function(e){var n=e.saveCallback,t=e.actionRef,r=H.Z.useForm(),a=c()(r,1)[0],i=(0,b.useState)(!1),s=c()(i,2),u=s[0],d=s[1],p=(0,b.useState)("LINK"),f=c()(p,2),v=f[0],h=f[1],x=(0,b.useState)(),g=c()(x,2),j=g[0],w=g[1];return(0,b.useImperativeHandle)(t,(function(){return{callCreateView:function(){d(!0)},callUpdateView:function(e){d(!0),w(e),a.setFieldsValue(e)}}})),(0,I.jsx)(_.Z,{width:880,title:"创建接口项目",destroyOnClose:!0,open:u,onCancel:function(){d(!1)},afterClose:function(){a.resetFields()},footer:(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(m.ZP,{onClick:function(){d(!1)},children:"取消"}),(0,I.jsx)(m.ZP,{type:"primary",onClick:l()(o()().mark((function e(){var t,r,i;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.validateFields();case 2:if((t=e.sent).config&&(r=JSON.parse(t.config),Object.assign(t,{config:r})),!j){e.next=10;break}return e.next=7,(0,V.yv)(j.id,t);case 7:e.t0=e.sent,e.next=13;break;case 10:return e.next=12,(0,V.B$)(t);case 12:e.t0=e.sent;case 13:(i=e.t0)&&i.success&&(y.ZP.success("保存成功"),d(!1),null==n||n());case 15:case"end":return e.stop()}}),e)}))),children:"提交"})]}),children:(0,I.jsxs)(H.Z,{form:a,labelCol:{span:4},wrapperCol:{span:18},initialValues:{importMethod:"LINK"},children:[(0,I.jsx)(H.Z.Item,{label:"项目名称",name:"name",rules:[{required:!0,message:"请输入项目名称"}],children:(0,I.jsx)(Z.Z,{placeholder:"项目名称"})}),(0,I.jsx)(H.Z.Item,{label:"导入方式",name:"importMethod",rules:[{required:!0,message:"请选择导入方式"}],children:(0,I.jsx)(E.default,{onChange:function(e){return h(e)},options:[{label:"Swagger Schema Path",value:"LINK"},{label:"Swagger Schema Content",value:"JSON"}]})}),"LINK"===v&&(0,I.jsx)(H.Z.Item,{label:"Schema Path",name:"importUrl",rules:[{required:!0,message:"请输入对应的Swagger文档JSON链接"}],children:(0,I.jsx)(Z.Z,{placeholder:"Swagger文档JSON链接，如：http://localhost:3000/docs-json"})}),"JSON"===v&&(0,I.jsx)(H.Z.Item,{label:"Schema Content",name:"config",rules:[{required:!0,message:"请输入Swagger Schema Content"},{validator:function(e,n){return(0,q.pM)(n)?Promise.resolve():Promise.reject(new Error("请输入合法的JSON"))},message:"请输入合法的JSON"}],children:(0,I.jsx)(Z.Z.TextArea,{rows:24,placeholder:"符合OpenAPI规范的Swagger Schema JSON Content"})})]})})},D=t(38653),W=["current","pageSize","keyword"],X=function(){var e=b.useRef(),n=(0,b.useState)(),t=c()(n,2),r=t[0],i=t[1],s=b.useRef(),u=b.useRef(null),w=b.useRef(),k=b.useState(""),C=c()(k,2),P=C[0],z=C[1],H=(0,O.useRequest)(V._j,{onSuccess:function(e){i(null==e?void 0:e[0])}}),_=H.data,E=H.loading,X=H.refresh;return(0,I.jsx)(J.Z,{activateKey:L.z_.DATASERVICE,children:(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)(d.Z,{children:[(0,I.jsx)(p.Z,{span:4,style:{paddingRight:6},children:(0,I.jsx)(f.Z,{title:"项目",loading:E,styles:{body:{padding:12,height:"83vh",overflowY:"auto"}},extra:(0,I.jsx)(v.Z,{title:"新增项目",children:(0,I.jsx)(m.ZP,{type:"primary",icon:(0,I.jsx)(A.Z,{}),onClick:function(){var e;null===(e=u.current)||void 0===e||e.callCreateView()}})}),children:(null==_?void 0:_.length)>0?(0,I.jsx)(h.Z,{style:{width:"100%",borderRight:"none"},selectedKeys:r?[r.uuid]:[],mode:"inline",items:null==_?void 0:_.map((function(n){return{key:n.uuid,style:{padding:12},label:(0,I.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,I.jsx)(x.Z.Text,{strong:!0,children:n.name}),(0,I.jsx)(g.Z,{trigger:["click"],menu:{items:[{label:"同步",key:"sync",icon:(0,I.jsx)($.Z,{}),onClick:(c=l()(o()().mark((function t(){var r,a,i,l;return o()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("LINK"!==n.importMethod){t.next=9;break}return r=y.ZP.loading("正在同步中"),t.next=4,(0,V.yv)(n.id);case 4:a=t.sent,r(),null!=a&&a.success&&(y.ZP.success("同步成功"),null===(i=e.current)||void 0===i||i.reload()),t.next=10;break;case 9:null===(l=s.current)||void 0===l||l.open(n);case 10:case"end":return t.stop()}}),t)}))),function(){return c.apply(this,arguments)})},{label:"编辑",key:"edit",icon:(0,I.jsx)(K.Z,{}),onClick:function(){var e;null===(e=u.current)||void 0===e||e.callUpdateView(n)}},{label:"删除",danger:!0,key:"delete",icon:(0,I.jsx)(B.Z,{}),onClick:(a=l()(o()().mark((function e(){var t;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,V.FW)(null==n?void 0:n.id);case 2:null!=(t=e.sent)&&t.success&&((null==r?void 0:r.id)===n.id&&i(void 0),X());case 4:case"end":return e.stop()}}),e)}))),function(){return a.apply(this,arguments)})}]},children:(0,I.jsx)(m.ZP,{size:"small",color:"default",variant:"filled",icon:(0,I.jsx)(T.Z,{style:{fontSize:16}}),onClick:function(e){e.stopPropagation()}})},"options")]}),onClick:(t=l()(o()().mark((function t(){var r;return o()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i(n),null===(r=e.current)||void 0===r||r.reload();case 2:case"end":return t.stop()}}),t)}))),function(){return t.apply(this,arguments)})};var t,a,c}))}):(0,I.jsx)(j.Z,{image:"https://gw.alipayobjects.com/zos/antfincdn/ZHrcdLPrvN/empty.svg",imageStyle:{height:60},description:(0,I.jsx)(x.Z.Text,{strong:!0,children:"还没有接口项目，请先创建一个吧"}),children:(0,I.jsx)(m.ZP,{type:"primary",icon:(0,I.jsx)(A.Z,{}),onClick:function(){var e;null===(e=u.current)||void 0===e||e.callCreateView()},children:"创建接口项目"})})})}),(0,I.jsx)(p.Z,{span:20,children:(0,I.jsx)(f.Z,{title:"接口列表",styles:{body:{padding:12,height:"83vh",overflowY:"auto"}},extra:(0,I.jsx)(Z.Z.Search,{value:P,style:{width:360},placeholder:"名称/描述/路径",enterButton:(0,I.jsx)(m.ZP,{type:"primary",icon:(0,I.jsx)(M.Z,{})}),onChange:function(e){return z(e.target.value)}}),children:r?(0,I.jsx)(S.Z,{rowKey:"uuid",size:"small",actionRef:e,tableAlertOptionRender:!1,tableAlertRender:!1,loading:E,toolBarRender:!1,pagination:{pageSize:18},search:!1,params:{keyword:P,groupId:null==r?void 0:r.id},request:function(e){var n=e.current,t=void 0===n?1:n,r=e.pageSize,i=void 0===r?20:r,o=e.keyword,s=a()(e,W);return o&&Object.assign(s,{OR:[{name:{contains:o}},{path:{contains:o}},{summary:{contains:o}}]}),(0,V.KR)({skip:(t-1)*i,take:i,where:(0,q.kL)(s)})},columns:[{title:"名称",dataIndex:"name",copyable:!0},{title:"描述",dataIndex:"summary"},{title:"路径",dataIndex:"path",copyable:!0},{title:"请求方式",dataIndex:"method"},{title:"请求参数",dataIndex:"requestBody",search:!1,render:function(e,n){var t;if(null!==(t=n.requestBody)&&void 0!==t&&null!==(t=t.content)&&void 0!==t&&null!==(t=t["application/json"])&&void 0!==t&&null!==(t=t.schema)&&void 0!==t&&t.$ref){var r,a=null===(r=n.requestBody)||void 0===r||null===(r=r.content)||void 0===r||null===(r=r["application/json"])||void 0===r||null===(r=r.schema)||void 0===r||null===(r=r.$ref)||void 0===r||null===(r=r.split("/"))||void 0===r?void 0:r.at(-1);return(0,I.jsx)(m.ZP,{type:"link",size:"small",onClick:l()(o()().mark((function e(){var t,r;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R({name:a,groupId:null==n?void 0:n.groupId});case 2:null!=(t=e.sent)&&t.success&&t.data&&(null===(r=w.current)||void 0===r||r.open(t.data));case 4:case"end":return e.stop()}}),e)}))),children:a})}return"-"}},{title:"返回对象",dataIndex:"responses",search:!1,render:function(e,n){var t;if(null!==(t=n.responses)&&void 0!==t&&null!==(t=t[200])&&void 0!==t&&null!==(t=t.content)&&void 0!==t&&null!==(t=t["application/json"])&&void 0!==t&&null!==(t=t.schema)&&void 0!==t&&t.$ref){var r,a=null===(r=n.responses)||void 0===r||null===(r=r[200])||void 0===r||null===(r=r.content)||void 0===r||null===(r=r["application/json"])||void 0===r||null===(r=r.schema)||void 0===r||null===(r=r.$ref)||void 0===r||null===(r=r.split("/"))||void 0===r?void 0:r.at(-1);return(0,I.jsx)(m.ZP,{type:"link",size:"small",onClick:l()(o()().mark((function e(){var t,r;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R({name:a,groupId:null==n?void 0:n.groupId});case 2:null!=(t=e.sent)&&t.success&&t.data&&(null===(r=w.current)||void 0===r||r.open(t.data));case 4:case"end":return e.stop()}}),e)}))),children:a})}return"-"}}]}):(0,I.jsx)(j.Z,{})})})]}),(0,I.jsx)(D.Z,{}),(0,I.jsx)(F.Z,{actionRef:s,submitCallback:function(){X()}}),(0,I.jsx)(U,{actionRef:u,saveCallback:function(){X()}}),(0,I.jsx)(N,{actionRef:w})]})})}},20370:function(e,n,t){t.d(n,{B$:function(){return u},CX:function(){return f},FT:function(){return h},FW:function(){return c},KR:function(){return d},Lk:function(){return v},_j:function(){return l},r$:function(){return s},r1:function(){return x},rn:function(){return p},yv:function(){return m}});var r=t(67825),a=t.n(r),i=t(92447),o=["datasource"],s=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i.ZP.post("api/datasources/database/list",e)},l=function(){return i.ZP.post("api/datasources/service-group/list")},u=function(e){return i.ZP.post("api/datasources/service-group",e)},c=function(e){return i.ZP.delete("api/datasources/service-group/".concat(e))},d=function(e){return i.ZP.post("api/datasources/dataservice/page",e)},p=function(e){return i.ZP.get("api/datasources/database/".concat(e,"/queryDatabaseTables/"))},f=function(e){var n=e.datasource,t=a()(e,o);return i.ZP.get("api/datasources/database/".concat(n,"/queryTableColumns/"),t)},v=function(e){return i.ZP.get("api/datasources/dataservice/".concat(e))},m=function(e,n){return i.ZP.post("api/datasources/service-group/".concat(e,"/migrate"),n)},h=function(e){return i.ZP.post("api/datasources/dataschema/list",e)},x=function(e){var n=e.datasource;return i.ZP.delete("api/datasources/database/".concat(n))}},16166:function(e,n,t){t.d(n,{XV:function(){return c},c7:function(){return f},e7:function(){return p},kL:function(){return d},pM:function(){return u}});var r=t(335),a=t.n(r),i=t(26068),o=t.n(i),s=t(82092),l=t.n(s),u=function(e){try{return JSON.parse(e),!0}catch(e){return!1}},c=function(e){var n;return/[A-Za-z]/.test(null==e?void 0:e.substring(0,1))?null==e||null===(n=e.substring(0,1))||void 0===n?void 0:n.toUpperCase():null==e?void 0:e.substring(0,1)},d=function(e){return Object.keys(e).reduce((function(n,t){return null!==e[t]&&""!==e[t]?Object.assign(n,l()({},t,e[t])):n}),{})},p=function(e,n){var t,r=o()({},e),i=a()(n);try{for(i.s();!(t=i.n()).done;){var s=t.value;r.hasOwnProperty(s)&&delete r[s]}}catch(e){i.e(e)}finally{i.f()}return r},f=function(e,n){var t=document.createElement("script");t.type="text/javascript",t.src=e,t.onload=function(){console.log("Script loaded: ".concat(e)),n&&n()},t.onerror=function(){console.error("Failed to load script: ".concat(e))},document.head.appendChild(t)}}}]);